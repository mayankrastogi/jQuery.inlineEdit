/* jquery.inlineEdit.js - Copyright (c) 2015 Mayank K Rastogi */
!function(e){function t(t){function a(t,n){n=n.trim();var a=e(t).attr(s.attributePrefix+n);return a&&(a=a.trim(),"type"==n&&(a=a.toLowerCase())),a}function i(t){var i=[];return t&&e(t).children().each(function(t,l){var s=a(l,"type");if(s&&-1!=e.inArray(s,n)){var o={"class":a(l,"class"),data:a(l,"data"),datePicker:a(l,"datePicker"),domElement:l,indexInRow:t,name:a(l,"name"),originalValue:e(l).html(),parentRowObject:null,type:s,validator:a(l,"validator")};i.push(o)}}),i}function l(t){var n=e(t).closest("tr"),a=void 0,i=e.grep(o,function(e){return e.domElement===n[0]});return 1==i.length&&(a=i[0]),a}var s=e.extend({},e.fn.inlineEdit.defaults,t);e("."+s.saveContainerClass,this).hide(),e("."+s.editContainerClass,this).show();var o=[];return e("tr",this).each(function(t,n){var a={domElement:n,editableColumns:i(n),editing:!1,rowIndex:t};e(a.editableColumns).each(function(e,t){t.parentRowObject=a}),o.push(a)}),e("."+s.cancelButtonClass,this).click(function(){var t=l(this);return t?t.editing?(e(t.editableColumns).each(function(t,n){e(n.domElement).html(n.originalValue)}),t.editing=!1,e("."+s.saveContainerClass,t.domElement).hide(),e("."+s.editContainerClass,t.domElement).show(),!1):(console.log("Row not in edit mode"),!1):!1}),e("."+s.editButtonClass,this).click(function(){var t=l(this);return t?t.editing?(console.log("Already in edit mode"),!1):(t.editableColumns&&(e(t.editableColumns).each(function(t,n){n.originalValue=e(n.domElement).html();var a,i,l,o,r,d=e("<input />").attr({type:"text","class":n["class"]?n["class"]:s.inputFieldClass,name:n.name,value:n.originalValue.trim()});switch(n.type){case"date":e(n.domElement).html(d),i=n.datePicker,e.isFunction(window[i])?window[i].call(d[0],n):s.datePicker?s.datePicker.call(d[0],n):(e(d).attr("type","date"),console.log('datePickerFunction: "'+i+'" is invalid'));break;case"hidden":e(d).attr("type","hidden");break;case"number":e(d).attr("type","number");break;case"percentage":e(d).attr("type","number"),r=e(d).attr("value").trim(),e(d).attr("value",r.substr(0,r.length-1));break;case"select":d=e("<select></select>").attr("name",n.name).attr("class",n["class"]?n["class"]:s.selectFieldClass),a=n.data,e.isFunction(window[a])?(l=window[a](),l&&e.each(l,function(t,a){o=e("<option></option>"),e(o).attr("value",t),e(o).html(a),n.originalValue.trim()==a&&e(o).attr("selected","selected"),e(d).append(o)})):console.log('dataFunction: "'+a+'" is invalid');break;case"textarea":d=e("<textarea></textarea>").attr({"class":n["class"]?n["class"]:s.textareaFieldClass,name:n.name,value:n.originalValue.trim()})}"hidden"==n.type?e(n.domElement).append(d):"date"!=n.type&&e(n.domElement).html(d)}),t.editing=!0,e("."+s.editContainerClass,t.domElement).hide(),e("."+s.saveContainerClass,t.domElement).show()),!1):!1}),e("."+s.saveButtonClass,this).click(function(){var t=l(this);if(!t)return!1;if(!t.editing)return console.log("Row not in edit mode"),!1;var n=!0;return e(t.editableColumns).each(function(t,a){if(!n)return!1;if(e.isFunction(window[a.validator])){var i=e("input, textarea, select",a.domElement)[0];window[a.validator].call(i)||(n=!1)}}),n&&e.ajax({url:s.saveButtonURL,type:"post",data:e("input, textarea, select",t.domElement).serialize(),dataType:"json",success:function(n){console.log(n),n.success?(e(t.editableColumns).each(function(t,n){e(n.domElement).html("select"==n.type?e("option:selected",n.domElement).text():e("input, textarea",n.domElement).val()),"percentage"==n.type&&e(n.domElement).append("%")}),t.editing=!1,e("."+s.saveContainerClass,t.domElement).hide(),e("."+s.editContainerClass,t.domElement).show(),s.onSaveSuccessful.call(this,n)):s.onSaveFailed.call(this,n)},error:function(e,t,n){s.onAjaxFailed.call(this,e,t,n)}}),!1}),this}e.fn.inlineEdit=t,e.fn.inlineEdit.defaults={attributePrefix:"inlineEdit-",saveButtonURL:"#",onAjaxFailed:function(){},onSaveFailed:function(){},onSaveSuccessful:function(){},editButtonClass:"inlineEdit-action-edit",saveButtonClass:"inlineEdit-action-save",cancelButtonClass:"inlineEdit-action-cancel",editContainerClass:"inlineEdit-edit-container",saveContainerClass:"inlineEdit-save-container",inputFieldClass:"inlineEdit-input",selectFieldClass:"inlineEdit-select",textareaFieldClass:"inlineEdit-textarea",datePicker:null};var n=["date","hidden","number","percentage","select","text","textarea"]}(jQuery);